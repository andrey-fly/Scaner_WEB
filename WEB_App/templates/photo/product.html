{% extends 'base/base.html' %}
{% load static %}
{% block title %}
<title>{{name}}</title>
{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<link rel="stylesheet" type="text/css" href="{% static 'css/product.css'%}">
<link rel="stylesheet" type="text/css" href="{% static 'css/star-rating-svg.css'%}">
<link type="text/css" rel="stylesheet" href="{% static 'css/magiczoomplus.css'%}"/>
<script type="text/javascript" src="{% static 'js/magiczoomplus.js'%}"></script>
<style>
    @media only screen and (max-width: 980px) {
        #photo-frame-in-content-group {
            display: none;
        }
        #content-group {
            width: auto;
        }
    }
    @media only screen and (max-width: 1275px) {
        #content-block {
            flex-wrap: wrap !important;
        }
    }

<!--    #gallery_01 img {-->
<!--        border: 2px solid white;-->
<!--    }-->

<!--    /*Change the colour*/-->
<!--    .active img {-->
<!--        border: 2px solid #333 !important;-->
<!--    }-->

    .status-card {
        padding: 20px;
    }

    .modal form {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 0 50px;
        height: 100%;
        text-align: center;
    }

    .modal-content-thanks {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        width: 100%;
        pointer-events: auto;
        background-clip: padding-box;
        outline: 0;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 0 10px 10px rgba(0, 0, 0, 0.22);
    }

    .modal-thanks-container {
        left: 0;
        z-index: 2;
        margin: 0 auto;
    }

    .thanks-container-modal {
        position: relative;
        overflow: hidden;
        width: 768px;
        max-width: 100%;
        padding: 0 40px 20px;
        margin-right: auto;
        margin-left: auto;
    }

    .modal-dialog-special {
        position: relative;
        width: auto;
        pointer-events: none;
    }

    .modal-header {
        border-bottom: none !important;
    }

    .thanks-text {
        font-family: Roboto-Regular;
        font-style: normal;
        font-weight: 900;
        font-size: 2rem;
        line-height: 120%;
        color: #007bff;
        text-align: center;
    }

    #timer-description {
        margin: 50px 0px 40px 0px;
        text-align: center;
        font-family: Roboto-Regular;
        font-style: normal;
        font-weight: 600;
        font-size: 18px;
        line-height: 120%;
    }

    @media (min-width: 576px){
        .modal-dialog-special {
            max-width: 500px;
            margin: 20vh auto;
        }
    }
    @media (max-width: 450px) {
        .modal-form {
            padding: 0 !important;
        }
    }


.conatiner {
	width: 100%;
	height: 500px;
}
.wrap {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
	-ms-flex-wrap: wrap;
	    flex-wrap: wrap;
	-webkit-box-pack: center;
	    -ms-flex-pack: center;
	        justify-content: center;
	-webkit-box-align: center;
	    -ms-flex-align: center;
	        align-items: center;
	-webkit-box-orient: horizontal;
	-webkit-box-direction: normal;
	    -ms-flex-direction: row;
	        flex-direction: row;
}

.box {
	margin: 10px;
	width: 300px;
	height: 490px;
	text-align: center;
	border-radius: 3px;
	-webkit-transition: 200ms ease-in-out;
	-o-transition: 200ms ease-in-out;
	transition: 200ms ease-in-out;
	-webkit-box-shadow: 0 0 15px rgba(0,0,0,0.3);
	        box-shadow: 0 0 15px rgba(0,0,0,0.3);
}
.box:hover {
	margin-bottom: -10px;
	-webkit-box-shadow: 0 0 5px rgba(0,0,0,0.7);
	        box-shadow: 0 0 5px rgba(0,0,0,0.7);
}
.box h1 {
	color: #fff;
	padding: 30px;
	margin-top: 100px;
	text-align: center;
	font-weight: 100;
	font-size: 25px;
	background: rgba(0,0,0,0.8);
	-webkit-box-shadow: 0 0 30px rgba(0,0,0,0.7);
	        box-shadow: 0 0 30px rgba(0,0,0,0.8);
}

.date h4 {
	color: #fff;
	font-weight: 300;
	text-align: center;
	letter-spacing: 3px;
	text-shadow: 0 0 3px rgba(0,0,0,0.9);
}
.poster {
	width: 130px;
	height:130px;
	margin: 120px auto;
	position: relative;
	border-radius: 100px;
}
.poster h4 {
	top: 45px;
	color: #fff;
	position: relative;
	font-size: 80px;
	text-align: center;
	font-weight: 100;
	font-size: 22px;
}
.one {
	background: #fff;
	background-repeat: no-repeat;
	background-size: cover;
	background-position: center;
}
/* POSTER*/
.p1 {
	background: #2b5876;  /* fallback for old browsers */
	background: -webkit-linear-gradient(to right, #4e4376, #2b5876);  /* Chrome 10-25, Safari 5.1-6 */
	background: -webkit-gradient(linear, left top, right top, from(#4e4376), to(#2b5876));
	background: -webkit-linear-gradient(left, #4e4376, #2b5876);
	background: -o-linear-gradient(left, #4e4376, #2b5876);
	background: linear-gradient(to right, #4e4376, #2b5876); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
	-webkit-box-shadow: 0 0 20px darkblue;
	        box-shadow: 0 0 20px darkblue;
}

</style>
{% endblock %}
{% block content %}
<div style="display: flex; flex-wrap: wrap;">
    <div id="content-block" style="flex-flow: column; margin: 10px auto; max-width: calc(100vw - 10px);">
        <div style="display: flex; flex-flow: column; max-width: calc(100vw - 10px);">
            <div id="photo-block-in-content-block" style="max-width: calc(100vw - 20px); width: 480px">
                {% if default_img %}
                <a id="zoom" href="{{default_img}}" class="MagicZoom"
                   data-options="zoomPosition: inner; variableZoom: true; selectorTrigger: hover; lazyZoom: true; expand: off; hint: always"><img
                        src="{{default_img}}"></a>
                {% else %}
                <a id="zoom" href="{{images.0.file.url}}" class="MagicZoom"
                   data-options="zoomPosition: inner; variableZoom: true; selectorTrigger: hover; lazyZoom: true; expand: off; hint: always"><img
                        src="{{images.0.file.url}}"></a>
                {% endif %}
                <div class="selectors" style="display: flex; flex-flow: row; max-width: 480px">
                    {% for image in images %}
                    <a data-zoom-id="zoom" href="{{image.file.url}}" data-image="{{image.file.url}}" title="..."
                       data-options="cssClass: no-expand-thumbnails" style="margin: 5px;"><img
                            src="{{image.file.url}}"/></a>
                    {% endfor %}
                </div>


                {% if user.is_authenticated %}
            </div>
            <label id="photo-load-label-in-photo-block">
                <a href="/gallery/{{name}}">Посмотрите все фото продукта</a>
            </label>
            <label id="photo-load-label-in-photo-block">
                <a name="add_photo" href="#" id="modal_btn" data-toggle="modal"
                   data-target="#modal-add">Или загрузить новое фото</a>
            </label>
            <div class="modal fade" id="modal-add" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog" role="document" style="max-width: 950px">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Добавьте ваше фото</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            {% if status == 'ok' %}
                            <div class="card status-card">
                                <p>Фотография успешно отправлена на модерацию</p>
                                <p>Вы можете добавить ещё одно фото</p>
                                <a class="btn btn-outline-primary" href="/">Или вернуться на главную страницу</a>
                            </div>
                            {% endif %}
                            {% if status == 'error' %}
                            <div class="card status-card">
                                <p style="color: darkred">При отправке на модерацию произошла ошибка</p>
                                <p>Убедитесь в том, что вы отправили правильный файл и попробуйте снова</p>
                                <a class="btn btn-outline-primary" href="/">Или вернитесь на главную страницу</a>
                            </div>
                            {% endif %}
                            <form id="content-group" method="POST" action="" enctype="multipart/form-data">
                                <div>
                                    {% csrf_token %}
                                    <input type="hidden" name="good_name" value="{{name}}">
                                    <div class="main-content-frame-in-content-group">
                                        <p class="header-text-in-main-content-frame">
                                            Добавьте вашу фотографию товара
                                        </p>
                                        <input id="file-input-for-label" type="file" accept="image/*" multiple
                                               onchange="func_submit_btn();" name="image">
                                        <label class="photo-load-button-in-main-content-frame btn-md"
                                               for="file-input-for-label"
                                               style="border: none; margin: 0 auto;">
                                            <span class="text-in-photo-load-button">
                                                Загрузить фото
                                            </span>
                                        </label>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close
                                        </button>
                                        <button type="submit" class="btn btn-outline-primary">Отправить на модерацию
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="thanksModal" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-dialog modal-dialog-special" role="document">
                    <div class="modal-content-thanks">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="thanks-container-modal">
                                <div class="modal-thanks-container">
                                    <h2 class="thanks-text">Спасибо за ваше фото!</h2>
                                    <p id="timer-description">
                                        Окно закроется через <span id="timer">5</span> секунд...
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        {% else %}
        <label id="photo-load-label-in-photo-block" style="text-align: center; margin: 5px;">
            <a href="/login/">Для просмотра галереи и добавление собственных фотографий, войдите или
                зарегестрируйтесь</a>
        </label>
        {% endif %}
    </div>
    <div id="info-block-in-content-block" style="margin: 15px auto; max-width: calc(100vw - 10px);">
        <ol class="breadcrumb">
            <!--                Молочные продукты > Сливочное масло-->
            {% for category in categories %}
            <li class="breadcrumb-item"><a href="/category/{{category}}">{{category}}</a></li>
            {% endfor %}
        </ol>
        <p id="product-name-in-info-block" style="max-width: inherit;">
            {{name}}
        </p>
        <div id="score-block-in-info-block" style="max-width: inherit;">
            <!--                Like or unlike block-->
            <div id="recommendation-block-in-score-block">
                <img src="{% static 'pics/like.svg'%}" id="image-recommendation-in-recommendation-block">
                <p id="text-recommendation-in-recommendation-block">
                    Можно брать
                </p>
            </div>
            <!--                Score in number block-->
            <div id="numbered-score-block-in-score-block" style="max-width: inherit;">
                <div id="numbered-score-figure-in-numbered-score-block">
                    <label id="score-number-in-numbered-score-figure">
                        {{points}}
                    </label>
                </div>
                <p id="numbered-score-description-in-numbered-score-block">
                    Оценка Росконтроль
                </p>
            </div>
        </div>
        <p style="margin: 20px">Лучшие отзывы:</p>
        <div class="conatiner" style="margin-top: 30px">
            <div class="wrap">
                {% for review in reviews %}
                    <div class="box one" style="max-width: 200px">
                        <div class="date">
                            <h4>{{review.create}}</h4>
                        </div>
                        <h1>{{review.text}}</h1>
                        <div class="poster p1">
                            <h4>{{review.user}}</h4>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% if user.is_authenticated %}
    <div id="comment-main-block">
        <div id="add-comment-block">
            <fieldset id="rating">
                {% if not rated %}
                <legend class="rating_caption" style="color: inherit;"> Ваша оценка:</legend>
                <div class="rating_group">
                    <form action="" method="POST">
                        {% csrf_token %}
                        <span class="my-rating-9"></span>
                        <span class="live-rating"></span>
                        <input id="rate" type="hidden" value="0" name="rating">
                        <button type="submit" class="btn btn-outline-primary ml-3">Оценить</button>
                    </form>
                    {% else %}
                    <p>Средняя оценка всеми пользователями:</p>
                    <div style="display: inline-flex">
                        <span class="my-rating-9"></span>
                        <p id="average" style="color: #10c46a; margin-left: 10px; font-size: 20px;">{{rated}}</p>
                    </div>
                </div>
                {% endif %}
            </fieldset>
            <div class="ui threaded comments">
                <h3 class="ui dividing header">Отзывы</h3>

                {% for comment in comments %}
                <div class="comment" id="{{comment.id}}-comment">
                    <div class="meta"
                    <div class="content">
                        <a class="ui author" style="font-size: 22px">{{comment.user}}</a>
                        <div class="metadata">
                            <div class="date">{{comment.created}}</div>
                        </div>
                        <div class="text" style="font-size: 17px">
                            {{comment.text}}
                        </div>
                    </div>
                </div>
                {% endfor %}
                <form class="ui reply" action="/product/{{name}}/?image={{img_id}}" method="post"
                      style="width:calc(100vw - 20px); max-width: 650px;margin-top: 1em;font-size: 1rem;position: relative;max-width: 100%;">
                    {% csrf_token %}
                    <div class="field">
                        <p>Оставьте ваш отзыв:</p>
                        <textarea id="example" name="comment" placeholder="Ваш отзыв"></textarea>
                    </div>
                    <div class="ui blue labeled submit icon button">
                        <i class="icon edit"></i><input type="submit" name="status" value="Отправить"
                                                        style="border: 0;background-color: #2185d0;color: white;">
                    </div>
                </form>
            </div>
            {% else %}
            <div id="comment-main-block">
                <div id="add-comment-block">
                    <fieldset id="rating">
                        <div class="rating_group">
                            <p>Средняя оценка всеми пользователями:</p>
                            <div style="display: inline-flex">
                                <span class="my-rating-9"></span>
                                <p id="average" style="color: #10c46a; margin-left: 10px; font-size: 20px;">{%if rated%}{{rated}}{%else%}0{%endif%}</p>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <div style="display: flex; flex-direction: column; text-align: center; max-width: calc(100vw - 10px)">
                <a href="/login/">Если вы хотите оставить ваше мнение или оценку для продукта, не забудьте войти</a>
                <a href="/login/" class="btn btn-outline-primary" style="max-width: 240px; align-self: center">Или
                    зарегестрироваться</a>
            </div>
        </div>
    </div>
    {% endif %}
    {% endblock %}
    {% block extra_js %}

    <!--Не переставляйте код, он перестанет работать!-->

    <script>
    function closeThanks(){
        setTimeout(() => $("#thanksModal [data-dismiss=modal]").trigger({ type: "click" }), 1000)
    };

    $('#thanksModal').on('shown.bs.modal', function (e) {
        i = 5;
        var count = setInterval(function() {
            document.getElementById("timer").innerHTML = i;
            if (i == 0) {
                closeThanks();
            }
            if (i > 0) {
                i = i - 1;
            }
        }, 1000);
    })




    </script>
    {% if show_thanks %}
    <script>
$('#thanksModal').modal('show');

    </script>
    {% endif %}

    {% if status == 'error' %}
    <script>
$('#add-modal').modal('show');

    </script>
    {% endif %}

    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>
    <script type="text/javascript" src="{% static 'js/jquery-1.8.3.min.js' %}"></script>
    <script src="{% static 'js/jquery.star-rating-svg.js' %}"></script>
    <script src="{% static 'js/jquery.autosize.js' %}"></script>
    <script>
$(document).ready(function(){
    $('textarea').autosize();
});

$('#example').val('').trigger('autosize.resize');

let rate = document.getElementById('rate')

$(".my-rating-9").starRating({
    starSize: 25,
    {% if not rated %}
    disableAfterRate: false,
    onHover: function(currentIndex, currentRating, $el){
      $('.live-rating').text(currentIndex);
    },
    onLeave: function(currentIndex, currentRating, $el){
      $('.live-rating').text(currentRating);
    },
    callback: function(currentRating, $el){
        // make a server call here
        rate.value = currentRating;
    }
    {% else %}
    initialRating : {{rated}},
    readOnly : true,
    {% endif %}
});
{% if rated %}
if ({{rated}} <= 3.5)
    $('#average').css('color', '#bf0704');
else
    $('#average').css('color', '#10c46a');
{% endif %}

var mzOptions = {
    zoomPosition: 'inner',
    selectorTrigger: 'hover',
    expand: 'off',
    hint: 'always'
};

    </script>

    {% endblock %}
